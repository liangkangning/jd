<?phpnamespace phone\controllers;use common\helpers\ArrayHelper;use common\models\Blog;use common\models\Category;use yii\helpers\Html;use yii\web\Controller;use Yii;class BlogController extends CommonController{    public function behaviors()    {        return [            [                'class' => 'yii\filters\PageCache',                'only' => ['index'],                'duration' => 3600,                'variations' => [                    Yii::$app->language,                    Yii::$app->request->get('page'),                ],            ],            [                'class' => 'yii\filters\PageCache',                'only' => ['detail'],                'duration' => 12*3600,                'variations' => [                    Yii::$app->language,                    Yii::$app->request->get('id'),                ],            ],        ];    }    public function init()    {        parent::init(); // TODO: Change the autogenerated stub        Yii::$app->params['news_list_image']=true;    }    public function actionIndex()    {        parent::common();        $category_dengji= Category::find()->where(['pid'=>34])->asArray()->all();        $this->data['category_dengji']=$category_dengji;//获取等级的栏目        $list= Blog::find()->select(['id','title','description','create_time'])->orderBy(['create_time' => SORT_DESC]);        $this->data['list']=$list;//获取列表下的所以文章        //        获取同等级栏目        $self_url='';        return $this->render('index',['data'=>$this->data]);    }    public function actionDetail(){        parent::common();        Yii::$app->params['breadcrumbs']=array();        Yii::$app->params['breadcrumbs'][]=Html::tag('a',"首页",['href'=>Yii::$app->homeUrl]);//面包屑        Yii::$app->params['breadcrumbs'][]='>'.Html::tag('a','电池博客',['href'=>'/blog/']);        if(Yii::$app->request->isGet){            $id=Yii::$app->request->get('id');            $item=Blog::find()                ->where(['id'=>$id])                ->one();//             var_dump($item);            $this->data['detail']=$item;            //查询上-篇文章            $prev_article = Blog::find()                ->andFilterWhere(['>', 'id', $id])                ->orderBy(['id' => SORT_ASC])                ->limit(1)                ->one();            //查询下-篇文章            $next_article = Blog::find()                ->andFilterWhere(['<', 'id', $id])                ->orderBy(['id' => SORT_DESC])                ->limit(1)                ->one();            $this->data['prev_article'] = [                'url' => !is_null($prev_article) ? \Yii::$app->urlManager->createUrl(['blog/detail','id'=>$prev_article->id]) : 'javascript:;',                'title' => !is_null($prev_article) ? $prev_article->title : '没有了',            ];            $this->data['next_article'] = [                'url' => !is_null($next_article) ? \Yii::$app->urlManager->createUrl(['blog/detail','id'=>$next_article->id]) : 'javascript:;',                'title' => !is_null($next_article) ? $next_article->title : '没有了',            ];        }//         echo 2;        return $this->render('detail',['data'=>$this->data]);    }    public function actionMip(){        parent::common();        Yii::$app->params['breadcrumbs']=array();        Yii::$app->params['breadcrumbs'][]=Html::tag('a',"首页",['href'=>Yii::$app->homeUrl]);//面包屑        Yii::$app->params['breadcrumbs'][]='>'.Html::tag('a','电池博客',['href'=>'/blog/']);        if(Yii::$app->request->isGet){            $id=Yii::$app->request->get('id');            $item=Blog::find()                ->where(['id'=>$id])                ->one();//             var_dump($item);            $this->data['detail']=$item;            //查询上-篇文章            $prev_article = Blog::find()                ->andFilterWhere(['>', 'id', $id])                ->orderBy(['id' => SORT_ASC])                ->limit(1)                ->one();            //查询下-篇文章            $next_article = Blog::find()                ->andFilterWhere(['<', 'id', $id])                ->orderBy(['id' => SORT_DESC])                ->limit(1)                ->one();            $this->data['prev_article'] = [                'url' => !is_null($prev_article) ? \Yii::$app->urlManager->createUrl(['blog/detail','id'=>$prev_article->id]) : 'javascript:;',                'title' => !is_null($prev_article) ? $prev_article->title : '没有了',            ];            $this->data['next_article'] = [                'url' => !is_null($next_article) ? \Yii::$app->urlManager->createUrl(['blog/detail','id'=>$next_article->id]) : 'javascript:;',                'title' => !is_null($next_article) ? $next_article->title : '没有了',            ];        }        $item->create_time=strtotime($item->create_time);        Yii::$app->params['detail']=$item;        $imagesUrl=ArrayHelper::getImgUrls($this->data['detail']->content);        if(count($imagesUrl)>0&&count($imagesUrl)<3){            $imagesUrl=array_slice($imagesUrl, 0,1);        }elseif(count($imagesUrl)>=3){            $imagesUrl=array_slice($imagesUrl, 0,3);        }        Yii::$app->params['imagesUrl']=$imagesUrl;        $this->layout = 'main_mip';        return $this->render('detail_mip',['data'=>$this->data]);    }}